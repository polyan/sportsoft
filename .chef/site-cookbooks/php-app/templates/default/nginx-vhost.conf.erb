#server {
#    charset utf-8;
#    client_max_body_size 128M;
#
#    listen 80;
#
#    server_name <%= @url %>;
#    root        <%= @root %>;
#    index       <%= @index %>;
#
#    access_log  <%= @access_log %>;
#    error_log   <%= @error_log %>;
#
#    # Redirect to index file if file does not exists
#    location / {
#        try_files $uri $uri/ /<%= @index %>?$args;
#    }
#
#    # Process static files with nginx
#    location ~ \.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar)$ {
#        try_files $uri =404;
#    }
#
#    # Process php files with php-fpm
#    location ~ \.php$ {
#        fastcgi_index <%= @index %>;
#        include fastcgi_params;
#        set $fsn /<%= @index %>;
#
#        <% if @allow_custom_scripts_execution -%>
#            # Allow execution if file exists (bypass index file)
#            if (-f $document_root$fastcgi_script_name){
#                set $fsn $fastcgi_script_name;
#            }
#        <% end -%>
#
#        fastcgi_param SCRIPT_FILENAME $document_root$fsn;
#        fastcgi_pass unix:<%= @socket %>;
#    }
#
#    # Deny access to all dot files/folders
#    location ~ /\. {
#        deny all;
#    }
#}
#server {
#        listen   80;
#        server_name site.dev www.site.dev;
#
#        access_log /var/www/site.dev/log/nginx/access.log bizon;
#        error_log /var/www/site.dev/log/nginx/error.log;
#
#        client_max_body_size  10m;
#        index index.php index.html index.htm;
#
#        location /uploads/ {
#                root /var/www/site.dev/data/app;
#                expires max;
#        }
#
#        location /bf/ {
#                alias /var/www/site.dev/data/app/backend/web/;
#                # added "/bf/": https://trac.nginx.org/nginx/ticket/97
#                try_files $uri /bf//bf/index.php$is_args$args;
#
#                location ~* ^.+\.(css|jpg|jpeg|gif|png|ico|zip|tgz|gz|rar|bz2|doc|xls|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js|html|swf)$ {
#                        expires max;
#                        access_log   off;
#                }
#
#                location ~ \.php$ {
#                        # added "/bf/": https://trac.nginx.org/nginx/ticket/97
#                        try_files $uri /bf//bf/index.php$is_args$args;
#
#                        fastcgi_pass unix:/var/run/php-fpm/site.dev.sock;
#                        fastcgi_index index.php;
#                        fastcgi_split_path_info ^/bf(/.+\.php)(.*)$;
#                        include fastcgi_params;
#                        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#                }
#        }
#
#        location / {
#                root /var/www/site.dev/data/app/frontend/web;
#                try_files $uri /index.php$is_args$args;
#
#                location ~* ^.+\.(css|jpg|jpeg|gif|png|ico|zip|tgz|gz|rar|bz2|doc|xls|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js|html|swf)$ {
#                        expires max;
#                        access_log   off;
#                }
#
#                location ~ \.php$ {
#                        try_files $uri /index.php$is_args$args;
#
#                        fastcgi_pass unix:/var/run/php-fpm/site.dev.sock;
#                        fastcgi_index index.php;
#                        include fastcgi_params;
#                        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#                }
#        }
#}

server {
    charset utf-8;
    client_max_body_size 128M;

    listen 80;

    server_name <%= @url %>;
    root        <%= @root %>;
    index       <%= @index %>;

    access_log  <%= @access_log %>;
    error_log   <%= @error_log %>;

    # Redirect to index file if file does not exists
    location / {
        try_files $uri $uri/ /<%= @index %>?$args;
    }

    location /admin/ {
            alias <%= @root %>/backend/web/;
            try_files $uri /admin//admin/<%= @index %>$is_args$args;
            location ~* ^.+\.(css|jpg|jpeg|gif|png|ico|zip|tgz|gz|rar|bz2|doc|xls|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js|html|swf)$ {
                    expires max;
                    access_log   off;
            }
            location ~ \.php$ {
                    # added "/bf/": https://trac.nginx.org/nginx/ticket/97
                    try_files $uri /admin//admin/<%= @index %>$is_args$args;
                    fastcgi_pass unix:<%= @socket %>;
                    fastcgi_index <%= @index %>;
                    fastcgi_split_path_info ^/admin(/.+\.php)(.*)$;
                    include fastcgi_params;
                    set $fsn /<%= @index %>;

                    <% if @allow_custom_scripts_execution -%>
                        # Allow execution if file exists (bypass index file)
                        if (-f $document_root$fastcgi_script_name){
                            set $fsn $fastcgi_script_name;
                        }
                    <% end -%>
                    fastcgi_param SCRIPT_FILENAME $document_root$fsn;
            }
    }
    location / {
            root <%= @root %>/frontend/web;
            try_files $uri /<%= @index %>$is_args$args;
            location ~* ^.+\.(css|jpg|jpeg|gif|png|ico|zip|tgz|gz|rar|bz2|doc|xls|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js|html|swf)$ {
                    expires max;
                    access_log   off;
            }
            location ~ \.php$ {
                    try_files $uri /<%= @index %>$is_args$args;
                    fastcgi_pass unix:<%= @socket %>;
                    fastcgi_index <%= @index %>;
                    include fastcgi_params;
                    set $fsn /<%= @index %>;

                                        <% if @allow_custom_scripts_execution -%>
                                            # Allow execution if file exists (bypass index file)
                                            if (-f $document_root$fastcgi_script_name){
                                                set $fsn $fastcgi_script_name;
                                            }
                                        <% end -%>
                    fastcgi_param SCRIPT_FILENAME $document_root$fsn;
            }
    }
    #Process static files with nginx
    location ~ \.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar)$ {
        try_files $uri =404;
    }



    # Deny access to all dot files/folders
    location ~ /\. {
        deny all;
    }
}